<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Calculadora de Carrinho</title>
    <meta name="theme-color" content="#007bff">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f0f2f5; margin: 0; padding: 0; padding-bottom: 80px; }
        
        /* Cabe√ßalho Fixo com o Total */
        .header-total {
            background: #fff; padding: 20px; text-align: center;
            position: sticky; top: 0; z-index: 100;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border-bottom-left-radius: 20px; border-bottom-right-radius: 20px;
        }
        .label-total { font-size: 0.9rem; color: #666; text-transform: uppercase; letter-spacing: 1px; }
        .valor-total { font-size: 3rem; font-weight: 800; color: #2e7d32; margin: 5px 0; transition: color 0.3s; }
        .valor-total.estourou { color: #d32f2f; } /* Vermelho se passar da meta */
        
        /* Barra de Progresso da Meta */
        .meta-container { margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .progress-bg { width: 100%; max-width: 200px; height: 8px; background: #eee; border-radius: 4px; overflow: hidden; position: relative; }
        .progress-fill { height: 100%; background: #2e7d32; width: 0%; transition: width 0.5s, background 0.3s; }
        
        /* Formul√°rio de Adi√ß√£o */
        .add-area { background: white; margin: 15px; padding: 15px; border-radius: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: grid; grid-template-columns: 2fr 1fr; gap: 10px; }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 1.1rem; outline: none; }
        input:focus { border-color: #007bff; }
        .btn-add { grid-column: span 2; background: #007bff; color: white; border: none; padding: 15px; border-radius: 10px; font-weight: bold; font-size: 1.1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .btn-add:active { transform: scale(0.98); }

        /* Lista de Itens */
        .item-list { list-style: none; padding: 0; margin: 15px; }
        .item-row { background: white; padding: 15px; margin-bottom: 10px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.03); animation: slideIn 0.2s; }
        @keyframes slideIn { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .item-info { display: flex; flex-direction: column; }
        .item-name { font-weight: 600; font-size: 1rem; color: #333; }
        .item-calc { font-size: 0.85rem; color: #888; }
        .item-price { font-weight: bold; font-size: 1.1rem; color: #333; }
        .btn-remove { background: #ffebee; color: #c62828; border: none; width: 35px; height: 35px; border-radius: 50%; margin-left: 10px; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; }

        /* Bot√£o Voltar Flutuante */
        .fab-back { position: fixed; bottom: 20px; left: 20px; background: white; color: #333; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-decoration: none; font-size: 24px; border: 1px solid #eee; z-index: 200; }

        /* Bot√£o Configurar Meta */
        .btn-meta { background: none; border: 1px solid #ddd; padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; color: #666; cursor: pointer; }
    </style>
</head>
<body>

<div class="header-total">
    <div class="label-total">Total do Carrinho</div>
    <div class="valor-total" id="display-total">R$ 0,00</div>
    
    <div class="meta-container">
        <div class="progress-bg"><div class="progress-fill" id="progress-bar"></div></div>
        <button class="btn-meta" onclick="definirMeta()">üéØ Meta: <span id="label-meta">R$ --</span></button>
    </div>
</div>

<div class="add-area">
    <input type="text" id="inp-nome" placeholder="Produto (Opcional)">
    <input type="number" id="inp-preco" placeholder="R$ 0,00" step="0.01">
    
    <div style="display:flex; gap:5px; grid-column: span 2;">
        <input type="number" id="inp-qtd" value="1" style="width: 70px; text-align:center;">
        <button class="btn-add" onclick="adicionarItem()">Ôºã Adicionar ao Carrinho</button>
    </div>
</div>

<div id="lista-itens" class="item-list">
    <div style="text-align:center; color:#999; margin-top:30px;">
        Seu carrinho est√° vazio üõí
    </div>
</div>

<a href="index.html" class="fab-back">‚¨Ö</a>

<script>
    let itens = [];
    let meta = localStorage.getItem('metaCarrinho') || 0;

    // Carregar dados salvos (se o usu√°rio fechou o app sem querer)
    if(localStorage.getItem('carrinhoTemp')) {
        itens = JSON.parse(localStorage.getItem('carrinhoTemp'));
        renderizar();
    }
    atualizarMetaDisplay();

    function adicionarItem() {
        const nome = document.getElementById('inp-nome').value || 'Item ' + (itens.length + 1);
        const preco = parseFloat(document.getElementById('inp-preco').value);
        const qtd = parseFloat(document.getElementById('inp-qtd').value);

        if (!preco || isNaN(preco)) return alert("Digite o pre√ßo!");

        const item = {
            id: Date.now(),
            nome: nome,
            preco: preco,
            qtd: qtd,
            total: preco * qtd
        };

        itens.unshift(item); // Adiciona no topo
        salvar();
        renderizar();
        limparInputs();
    }

    function removerItem(id) {
        itens = itens.filter(i => i.id !== id);
        salvar();
        renderizar();
    }

    function renderizar() {
        const lista = document.getElementById('lista-itens');
        const displayTotal = document.getElementById('display-total');
        const barra = document.getElementById('progress-bar');
        
        lista.innerHTML = '';
        let totalGeral = 0;

        itens.forEach(item => {
            totalGeral += item.total;
            const div = document.createElement('div');
            div.className = 'item-row';
            div.innerHTML = `
                <div class="item-info">
                    <span class="item-name">${item.nome}</span>
                    <span class="item-calc">${item.qtd}x ${formatarMoeda(item.preco)}</span>
                </div>
                <div style="display:flex; align-items:center;">
                    <span class="item-price">${formatarMoeda(item.total)}</span>
                    <button class="btn-remove" onclick="removerItem(${item.id})">&times;</button>
                </div>
            `;
            lista.appendChild(div);
        });

        // Atualiza Total
        displayTotal.innerText = formatarMoeda(totalGeral);
        
        // L√≥gica da Meta (Cor e Barra)
        if (meta > 0) {
            const porcentagem = (totalGeral / meta) * 100;
            barra.style.width = Math.min(porcentagem, 100) + '%';
            
            if (totalGeral > meta) {
                displayTotal.classList.add('estourou');
                barra.style.backgroundColor = '#d32f2f'; // Vermelho
            } else {
                displayTotal.classList.remove('estourou');
                barra.style.backgroundColor = '#2e7d32'; // Verde
            }
        } else {
            barra.style.width = '0%';
        }
    }

    function definirMeta() {
        const novaMeta = prompt("Qual √© o seu limite de gastos para hoje?", meta || "");
        if (novaMeta) {
            meta = parseFloat(novaMeta.replace(',', '.'));
            localStorage.setItem('metaCarrinho', meta);
            atualizarMetaDisplay();
            renderizar();
        }
    }

    function atualizarMetaDisplay() {
        const label = document.getElementById('label-meta');
        if(meta > 0) label.innerText = formatarMoeda(meta);
        else label.innerText = "Definir";
    }

    function salvar() {
        localStorage.setItem('carrinhoTemp', JSON.stringify(itens));
    }

    function limparInputs() {
        document.getElementById('inp-nome').value = '';
        document.getElementById('inp-preco').value = '';
        document.getElementById('inp-qtd').value = '1';
        document.getElementById('inp-preco').focus(); // J√° foca no pre√ßo pro pr√≥ximo
    }

    function formatarMoeda(valor) {
        return valor.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'});
    }
</script>

</body>
</html>